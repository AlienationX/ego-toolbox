{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'zh-hans' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Toolbox{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Toolbox - æ±‡é›†æ•ˆç‡ã€åˆ›æ„ä¸å¼€å‘åœºæ™¯çš„åœ¨çº¿å·¥å…·åˆé›†ï¼Œæ”¯æŒåˆ†ç±»ç­›é€‰ä¸å¤šè¯­è¨€åˆ‡æ¢ï¼ŒåŠ©ä½ å¿«é€Ÿæ‰¾åˆ°åˆé€‚çš„å·¥å…·ã€‚{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}Toolbox,åœ¨çº¿å·¥å…·é›†,æ•ˆç‡å·¥å…·,åˆ›æ„å·¥å…·,å¼€å‘å·¥å…·{% endblock %}">
    <link rel="canonical" href="{{ request.build_absolute_uri|default:'/' }}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Toolbox - åœ¨çº¿å·¥å…·é›†{% endblock %}">
    <meta property="og:description" content="{% block og_description %}ç²¾é€‰å¤šç±»åˆ«åœ¨çº¿å·¥å…·ï¼Œæ”¯æŒåˆ†ç±»ç­›é€‰ã€æ·±è‰²æ¨¡å¼ä¸ä¸­è‹±æ–‡åˆ‡æ¢ï¼Œæ‰“é€ æç®€åˆé«˜æ•ˆçš„å·¥ä½œå…¥å£ã€‚{% endblock %}">
    <meta property="og:url" content="{{ request.build_absolute_uri|default:'/' }}">
    <meta property="og:site_name" content="Toolbox">
    <meta property="og:image" content="{% block og_image %}{{ request.scheme|default:'https' }}://{{ request.get_host }}/static/toolbox/images/preview.png{% endblock %}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}Toolbox - åœ¨çº¿å·¥å…·é›†{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}ä»¥ç°ä»£è®¾è®¡è¯­è¨€å‘ˆç°çš„å·¥å…·é›†åˆï¼Œèšåˆæ•ˆç‡ã€åˆ›æ„ä¸å¼€å‘åœºæ™¯çš„ä¸€ç«™å¼å…¥å£ã€‚{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{{ request.scheme|default:'https' }}://{{ request.get_host }}/static/toolbox/images/preview.png{% endblock %}">
    {% block extra_meta %}{% endblock %}
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script>tailwind.config = {darkMode: "class"}</script>
    <script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"></script>
    {% load static %}
    <!-- ä¸»é¢˜æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="{% static 'toolbox/css/light.css' %}" id="light-theme">
    <link rel="stylesheet" href="{% static 'toolbox/css/dark.css' %}" id="dark-theme">
    {% block extra_css %}{% endblock %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Toolbox",
        "url": "{{ request.build_absolute_uri|default:'/' }}",
        "inLanguage": "{{ LANGUAGE_CODE|default:'zh-Hans' }}",
        "description": "Toolbox - åœ¨çº¿å·¥å…·é›†ï¼Œèšåˆæ•ˆç‡ã€åˆ›æ„ã€å¼€å‘ç­‰å¤šç§åœºæ™¯çš„ç²¾é€‰å·¥å…·ã€‚",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "{{ request.build_absolute_uri|default:'/' }}?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
</head>
<body>
    <div class="top-controls fixed top-5 right-5 z-50 flex gap-3">
        <button class="theme-toggle btn btn-sm rounded-full bg-base-200 hover:bg-base-300" id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜" aria-label="åˆ‡æ¢ä¸»é¢˜">
            <span class="theme-icon-light">â˜€ï¸</span>
            <span class="theme-icon-dark" style="display: none;">ğŸŒ™</span>
        </button>
        <div class="lang-switcher flex gap-3">
                {% get_current_language as CURRENT_LANGUAGE %}
                {% get_available_languages as LANGUAGES %}
                {% for lang_code, lang_name in LANGUAGES %}
                    {% if lang_code != CURRENT_LANGUAGE %}
                        <button onclick="switchLanguageDirectly('{{ lang_code }}')" class="btn btn-sm rounded-full bg-base-200 hover:bg-base-300" title="{% trans 'åˆ‡æ¢åˆ°' %} {{ lang_name }}">
                            {% if lang_code == 'zh-hans' %}ä¸­{% else %}EN{% endif %}
                        </button>
                    {% endif %}
                {% endfor %}
            </div>
    </div>
    <div class="container mx-auto px-4 py-12">
        {% block content %}{% endblock %}
    </div>
    {% block extra_js %}{% endblock %}
    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ (å…¼å®¹daisyUI)
        (function() {
            const themeToggle = document.getElementById('theme-toggle');
            const html = document.documentElement;
            const lightIcon = themeToggle.querySelector('.theme-icon-light');
            const darkIcon = themeToggle.querySelector('.theme-icon-dark');
            const lightThemeLink = document.getElementById('light-theme');
            const darkThemeLink = document.getElementById('dark-theme');
            
            // ä» localStorage è¯»å–ä¸»é¢˜åå¥½ï¼Œæˆ–ä½¿ç”¨ç³»ç»Ÿåå¥½
            function getInitialTheme() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    return savedTheme;
                }
                // æ£€æµ‹ç³»ç»Ÿåå¥½
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return 'dark';
                }
                return 'light';
            }
            
            // åº”ç”¨ä¸»é¢˜ (daisyUIå…¼å®¹ç‰ˆæœ¬)
            function setTheme(theme) {
                if (theme === 'dark') {
                    html.setAttribute('data-theme', 'dark');
                    html.classList.add('dark');
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'inline';
                    localStorage.setItem('theme', 'dark');
                } else {
                    html.setAttribute('data-theme', 'light');
                    html.classList.remove('dark');
                    lightIcon.style.display = 'inline';
                    darkIcon.style.display = 'none';
                    localStorage.setItem('theme', 'light');
                }
            }
            
            // åˆå§‹åŒ–ä¸»é¢˜
            const initialTheme = getInitialTheme();
            setTheme(initialTheme);
            
            // åˆ‡æ¢ä¸»é¢˜
            themeToggle.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme');
                setTheme(currentTheme === 'dark' ? 'light' : 'dark');
            });
            
            // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    setTheme(e.matches ? 'dark' : 'light');
                }
            });
        }
    })();
    </script>
    <script>
        // è¯­è¨€åˆ‡æ¢å‡½æ•° - ç›´æ¥æ„é€ URLå¹¶è·³è½¬
        function switchLanguageDirectly(langCode) {
            const currentUrl = window.location.href;
            const currentPath = window.location.pathname;
            
            // æå–æŸ¥è¯¢å‚æ•°
            const queryParams = window.location.search;
            
            // æ ¹æ®ç›®æ ‡è¯­è¨€æ„é€ æ–°çš„URL
            let newPath;
            if (langCode === 'zh-hans') {
                // åˆ‡æ¢åˆ°ä¸­æ–‡ - ç§»é™¤/en/å‰ç¼€
                newPath = currentPath.replace(/^\/en\//, '/');
            } else {
                // åˆ‡æ¢åˆ°è‹±æ–‡ - æ·»åŠ /en/å‰ç¼€ï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰
                if (currentPath.startsWith('/en/')) {
                    newPath = currentPath;
                } else {
                    newPath = '/en' + currentPath;
                }
            }
            
            // æ„é€ å®Œæ•´çš„æ–°URL
            const newUrl = window.location.origin + newPath + queryParams;
            
            // è·³è½¬åˆ°æ–°URL
            window.location.href = newUrl;
        }
    </script>
</body>
</html>

